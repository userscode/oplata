<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFC –û–ø–ª–∞—Ç–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .payment-container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            text-align: center;
            max-width: 400px;
            width: 100%;
        }

        .status-message {
            font-size: 18px;
            color: #333;
            margin-bottom: 30px;
            min-height: 54px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .amount {
            font-size: 36px;
            font-weight: bold;
            color: #2c3e50;
            margin: 20px 0;
        }

        .currency {
            color: #7f8c8d;
            font-size: 24px;
        }

        .loader-container {
            margin: 30px 0;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ */
        .loader {
            width: 80px;
            height: 80px;
            border: 8px solid #f3f3f3;
            border-top: 8px solid #3498db;
            border-radius: 50%;
            margin: 0 auto;
            animation: spin 1s linear infinite;
        }

        /* –ì–∞–ª–æ—á–∫–∞ */
        .checkmark {
            width: 80px;
            height: 80px;
            margin: 0 auto;
        }

        .checkmark__circle {
            stroke-dasharray: 166;
            stroke-dashoffset: 166;
            stroke-width: 2;
            stroke-miterlimit: 10;
            stroke: #4CAF50;
            fill: none;
            animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
        }

        .checkmark__check {
            transform-origin: 50% 50%;
            stroke-dasharray: 48;
            stroke-dashoffset: 48;
            animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
        }

        .payment-success {
            color: #27ae60;
            font-weight: bold;
            font-size: 24px;
            margin-top: 20px;
            animation: fadeIn 0.5s ease;
        }

        .nfc-icon {
            font-size: 48px;
            margin: 20px 0;
            color: #3498db;
        }

        .scanning-animation {
            width: 100px;
            height: 100px;
            border: 3px solid #3498db;
            border-radius: 50%;
            margin: 20px auto;
            position: relative;
            animation: pulse 2s infinite;
        }

        .instructions {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            font-size: 14px;
            color: #666;
        }

        .error-message {
            color: #e74c3c;
            background: #ffeaea;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            display: none;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes stroke {
            100% {
                stroke-dashoffset: 0;
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0% {
                transform: scale(0.8);
                opacity: 1;
            }
            50% {
                transform: scale(1.2);
                opacity: 0.7;
            }
            100% {
                transform: scale(0.8);
                opacity: 1;
            }
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="payment-container">
        <div class="nfc-icon">üì±</div>
        
        <div class="status-message" id="statusMessage">
            –ì–æ—Ç–æ–≤ –∫ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—é NFC...
        </div>
        
        <div class="amount">
            <span class="currency">‚ÇΩ</span> 34,57
        </div>

        <div class="scanning-animation" id="scanningAnimation"></div>

        <div class="loader-container">
            <div class="loader" id="loader"></div>
            <div class="checkmark hidden" id="checkmark">
                <svg viewBox="0 0 52 52">
                    <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>
                    <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
                </svg>
            </div>
        </div>

        <div class="payment-success hidden" id="successMessage">
            –û–ø–ª–∞—á–µ–Ω–æ! ‚úÖ
        </div>

        <div class="error-message" id="errorMessage">
            –û—à–∏–±–∫–∞ NFC. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–¥–µ—Ä–∂–∫—É –±—Ä–∞—É–∑–µ—Ä–æ–º –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è.
        </div>

        <div class="instructions">
            <strong>–ö–∞–∫ –æ–ø–ª–∞—Ç–∏—Ç—å:</strong><br>
            1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å–∞–π—Ç –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ<br>
            2. –ü–æ–¥–Ω–µ—Å–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω –∫ NFC –º–µ—Ç–∫–µ<br>
            3. –û–ø–ª–∞—Ç–∞ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
        </div>
    </div>

    <script>
        let paymentCompleted = false;
        let nfcReader = null;

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
        function updateStatus(message) {
            document.getElementById('statusMessage').textContent = message;
        }

        // –§—É–Ω–∫—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–ø–ª–∞—Ç—ã
        function completePayment() {
            if (paymentCompleted) return;
            
            paymentCompleted = true;
            
            const loader = document.getElementById('loader');
            const checkmark = document.getElementById('checkmark');
            const successMessage = document.getElementById('successMessage');
            const scanningAnimation = document.getElementById('scanningAnimation');

            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º NFC —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
            if (nfcReader) {
                // –í —Ä–µ–∞–ª—å–Ω–æ–º API –º–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å nfcReader.stop(), –Ω–æ –≤ Web NFC –Ω–µ—Ç —Ç–∞–∫–æ–≥–æ –º–µ—Ç–æ–¥–∞
                nfcReader = null;
            }

            // –°–∫—Ä—ã–≤–∞–µ–º loader –∏ –∞–Ω–∏–º–∞—Ü–∏—é —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≥–∞–ª–æ—á–∫—É
            loader.classList.add('hidden');
            scanningAnimation.classList.add('hidden');
            checkmark.classList.remove('hidden');
            successMessage.classList.remove('hidden');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
            updateStatus('–û–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ!');
        }

        // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å NFC
        async function startNFCScanning() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É NFC
            if (!('NDEFReader' in window)) {
                showError('NFC –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤–∞—à–∏–º –±—Ä–∞—É–∑–µ—Ä–æ–º');
                return;
            }

            try {
                updateStatus('–°–∫–∞–Ω–∏—Ä—É—é NFC –º–µ—Ç–∫–∏...');
                
                // –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä NDEFReader
                nfcReader = new NDEFReader();

                // –ó–∞–ø—É—Å–∫–∞–µ–º —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
                await nfcReader.scan();
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É—Å–ø–µ—à–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è –º–µ—Ç–∫–∏
                nfcReader.onreading = (event) => {
                    console.log('NFC –º–µ—Ç–∫–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞:', event);
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –æ–ø–ª–∞—Ç–∞ –µ—â–µ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
                    if (!paymentCompleted) {
                        updateStatus('–ú–µ—Ç–∫–∞ —Å—á–∏—Ç–∞–Ω–∞, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é –æ–ø–ª–∞—Ç—É...');
                        
                        // –ò–º–∏—Ç–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–∞ (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã API –∑–∞–ø—Ä–æ—Å)
                        setTimeout(() => {
                            completePayment();
                        }, 1000);
                    }
                };

                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ —á—Ç–µ–Ω–∏—è
                nfcReader.onreadingerror = (error) => {
                    console.error('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è NFC:', error);
                    updateStatus('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –º–µ—Ç–∫–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
                };

                updateStatus('–ì–æ—Ç–æ–≤ –∫ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—é. –ü–æ–¥–Ω–µ—Å–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω –∫ NFC –º–µ—Ç–∫–µ...');

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ NFC:', error);
                handleNFCError(error);
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ NFC
        function handleNFCError(error) {
            let errorMessage = '–û—à–∏–±–∫–∞ NFC: ';
            
            if (error.name === 'NotAllowedError') {
                errorMessage += '–î–æ—Å—Ç—É–ø –∫ NFC –∑–∞–ø—Ä–µ—â–µ–Ω. –†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞.';
            } else if (error.name === 'NotSupportedError') {
                errorMessage += 'NFC –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º.';
            } else {
                errorMessage += error.message;
            }
            
            showError(errorMessage);
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
        function showError(message) {
            const errorElement = document.getElementById('errorMessage');
            errorElement.textContent = message;
            errorElement.style.display = 'block';
            updateStatus('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ NFC');
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            setTimeout(() => {
                startNFCScanning();
            }, 1000);
        });

        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è iOS/Safari
        if (navigator.userAgent.match(/iPhone|iPad|iPod/i)) {
            document.addEventListener('visibilitychange', function() {
                if (!document.hidden && !paymentCompleted && !nfcReader) {
                    // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–≥–¥–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–æ–π
                    setTimeout(startNFCScanning, 500);
                }
            });
        }
    </script>
</body>
</html>